<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoreCade Developer Dashboard</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1c2e 0%, #2d3748 100%);
            color: #e2e8f0;
        }
        .game-font {
            font-family: 'Orbitron', sans-serif;
        }
        .sidebar {
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nav-link {
            transition: all 0.3s ease;
            border-radius: 0.5rem;
            margin: 0.5rem 0;
        }
        .nav-link:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: translateX(5px);
        }
        .nav-link.active {
            background: #3b82f6;
            color: white;
        }
        .card {
            background: rgba(31, 41, 55, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="flex">
        <!-- Sidebar -->
        <div class="w-64 min-h-screen sidebar p-6">
            <div class="text-center mb-8">
                <h1 class="text-2xl font-bold game-font text-blue-400">CoreCade</h1>
                <p class="text-sm text-gray-400">Developer Portal</p>
            </div>
            <nav class="space-y-2">
                <a href="#" class="nav-link active flex items-center p-3" data-tab="dashboard">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                    </svg>
                    Dashboard
                </a>
                <a href="#" class="nav-link flex items-center p-3" data-tab="tokens">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Tokens
                </a>
                <a href="#" class="nav-link flex items-center p-3" data-tab="games">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path>
                    </svg>
                    Games
                </a>
                <a href="#" class="nav-link flex items-center p-3" data-tab="analytics">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    Analytics
                </a>
                <a href="#" class="nav-link flex items-center p-3" data-tab="settings">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Settings
                </a>
                <div class="mt-auto pt-4">
                    <a href="#" class="nav-link flex items-center p-3 text-red-400 hover:bg-red-500/20" id="logoutBtn">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                        Logout
                    </a>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-8">
            <!-- Dashboard Tab -->
            <div class="tab-content active" id="dashboard">
                <div class="card p-6">
                    <h2 class="text-2xl font-bold mb-6 game-font text-blue-400">TokenGuard AI Setup</h2>
                    <p class="text-gray-400 mb-8">Tell us about your game and target audience. Our AI will analyze your responses to create a custom security configuration.</p>
                    
                    <form class="space-y-8" id="tokenGuardForm">
                        <div class="space-y-6">
                            <div>
                                <label class="block text-xl font-semibold text-blue-400 mb-2">Describe your tokens and their mechanics</label>
                                <textarea 
                                    class="w-full px-4 py-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 h-32" 
                                    name="gameDescription" 
                                    placeholder="Example: My game is a play-to-earn RPG where players earn tokens by completing quests and winning battles. Players can use tokens to buy in-game items and trade with other players..."
                                    required
                                ></textarea>
                                <p class="text-sm text-gray-400 mt-2">Include how players earn and use tokens in your game</p>
                            </div>

                            <div>
                                <label class="block text-xl font-semibold text-blue-400 mb-2">Describe your target audience and their behavior</label>
                                <textarea 
                                    class="w-full px-4 py-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 h-32" 
                                    name="customerProfile" 
                                    placeholder="Example: Our target audience is casual gamers aged 18-35 who play 2-3 hours daily. They typically play in the evenings and weekends. Most players are interested in collecting items and trading with others. We expect them to engage with the game's social features..."
                                    required
                                ></textarea>
                                <p class="text-sm text-gray-400 mt-2">Describe your ideal players, their gaming habits, and typical behavior patterns</p>
                            </div>

                            <div>
                                <label class="block text-xl font-semibold text-blue-400 mb-2">What's your ideal token economy?</label>
                                <textarea 
                                    class="w-full px-4 py-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 h-32" 
                                    name="tokenEconomy" 
                                    placeholder="Example: I want players to earn around 10 tokens per hour through normal gameplay. Top players should be able to earn up to 25 tokens per hour. New players should start with 5 tokens..."
                                    required
                                ></textarea>
                                <p class="text-sm text-gray-400 mt-2">Describe your ideal token distribution and earning rates</p>
                            </div>
                        </div>

                        <button type="submit" class="btn-primary px-6 py-3 rounded-lg font-semibold text-white w-full md:w-auto">
                            Generate Security Settings
                        </button>
                        <button type="button" id="tryBouncerBtn" class="ml-4 px-6 py-3 rounded-lg font-semibold text-white bg-purple-600 hover:bg-purple-700 transition-colors">
                            Try Bouncer
                        </button>
                    </form>
                </div>
            </div>

            <!-- Bouncer Chat Modal -->
            <div id="bouncerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                <div class="bg-gray-800 rounded-lg w-full max-w-4xl mx-4 h-[80vh] flex flex-col">
                    <!-- Modal Header -->
                    <div class="p-4 border-b border-gray-700 flex justify-between items-center">
                        <h3 class="text-xl font-bold text-blue-400">TokenGuard Bouncer Chat</h3>
                        <button id="closeModalBtn" class="text-gray-400 hover:text-white">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Chat Messages -->
                    <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-4">
                        <!-- Messages will be added here -->
                    </div>

                    <!-- Chat Input -->
                    <div class="p-4 border-t border-gray-700">
                        <form id="chatForm" class="flex space-x-4">
                            <input type="text" id="chatInput" 
                                class="flex-1 px-4 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 text-white"
                                placeholder="Type your message..."
                            >
                            <button type="submit" class="px-6 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600 transition-colors">
                                Send
                            </button>
                        </form>
                        <button id="endBouncerBtn" class="mt-4 px-6 py-2 rounded-lg bg-red-500 text-white hover:bg-red-600 transition-colors w-full">
                            End Bouncer Test
                        </button>
                    </div>
                </div>
            </div>

            <!-- Gameplay Test Modal -->
            <div id="gameplayModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                <div class="bg-gray-800 rounded-lg w-full max-w-4xl mx-4 h-[80vh] flex flex-col">
                    <!-- Modal Header -->
                    <div class="p-4 border-b border-gray-700 flex justify-between items-center">
                        <h3 class="text-xl font-bold text-blue-400">Game Test <span id="gameTestTitle"></span></h3>
                        <button id="closeGameplayModalBtn" class="text-gray-400 hover:text-white">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Game Messages -->
                    <div id="gameMessages" class="flex-1 overflow-y-auto p-4 space-y-4">
                        <!-- Messages will be added here -->
                    </div>

                    <!-- Game Input -->
                    <div class="p-4 border-t border-gray-700">
                        <form id="gameTestForm" class="flex space-x-4">
                            <input type="text" id="gameInput" 
                                class="flex-1 px-4 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 text-white"
                                placeholder="Type your message..."
                            >
                            <button type="submit" class="px-6 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600 transition-colors">
                                Send
                            </button>
                        </form>
                        <button id="endGameTestBtn" class="mt-4 px-6 py-2 rounded-lg bg-red-500 text-white hover:bg-red-600 transition-colors w-full">
                            End Game Test
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tokens Tab -->
            <div class="tab-content" id="tokens">
                <div class="card p-6 mb-8">
                    <h2 class="text-2xl font-bold mb-6 game-font">Create New Token</h2>
                    <form class="token-form space-y-6" id="tokenForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium mb-2">Token Name</label>
                                <input type="text" class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500" id="tokenName" required>
                                <p class="text-sm text-gray-400 mt-1">The full name of your token (e.g., "My Game Token")</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Token Symbol</label>
                                <input type="text" class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500" id="tokenSymbol" required>
                                <p class="text-sm text-gray-400 mt-1">A short symbol for your token (e.g., "MGT")</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Decimals</label>
                                <input type="number" class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500" id="tokenDecimals" value="18" required>
                                <p class="text-sm text-gray-400 mt-1">Number of decimal places (default: 18)</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Total Supply</label>
                                <input type="number" class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500" id="totalSupply" required>
                                <p class="text-sm text-gray-400 mt-1">The total number of tokens to create</p>
                            </div>
                        </div>
                        <button type="submit" class="btn-primary px-6 py-3 rounded-lg font-semibold text-white w-full md:w-auto">
                            Create Token
                        </button>
                    </form>
                </div>

                <div class="card p-6">
                    <h2 class="text-2xl font-bold mb-6 game-font">My Tokens</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="text-left border-b border-gray-700">
                                    <th class="pb-4">Name</th>
                                    <th class="pb-4">Symbol</th>
                                    <th class="pb-4">Total Supply</th>
                                    <th class="pb-4">Contract Address</th>
                                    <th class="pb-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tokensList" class="divide-y divide-gray-700">
                                <!-- Tokens will be populated here via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Games Tab -->
            <div class="tab-content" id="games">
                <div class="card p-6 mb-8">
                    <h2 class="text-2xl font-bold mb-6 game-font text-blue-400">Create New Game</h2>
                    <form class="game-form space-y-6" id="gameForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium mb-2">Game Title</label>
                                <input type="text" class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500" id="gameTitle" required>
                                <p class="text-sm text-gray-400 mt-1">The name of your game</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Game Type</label>
                                <select class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500" id="gameType" required>
                                    <option value="">Select a game type</option>
                                    <option value="1">Text Adventure</option>
                                    <option value="2">Strategy Game</option>
                                    <option value="3">Puzzle Game</option>
                                    <option value="4">RPG</option>
                                    <option value="5">Other</option>
                                </select>
                                <p class="text-sm text-gray-400 mt-1">The type of game you're creating</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Cost in CORE</label>
                                <input type="number" step="0.01" min="0" class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500" id="costInCore" required>
                                <p class="text-sm text-gray-400 mt-1">Cost to play in CORE tokens</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Token Reward</label>
                                <input type="number" min="0" class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500" id="tokenReward" required>
                                <p class="text-sm text-gray-400 mt-1">Amount of game tokens awarded to winners</p>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium mb-2">Game Token for Rewards</label>
                                <select class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500" id="gameToken" required>
                                    <option value="">Select a token</option>
                                    <!-- Token options will be loaded dynamically -->
                                </select>
                                <p class="text-sm text-gray-400 mt-1">The token used for rewarding players in this game</p>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium mb-2">Game Description</label>
                                <textarea class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 h-32" id="gameDescription" required></textarea>
                                <p class="text-sm text-gray-400 mt-1">A detailed description of your game</p>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium mb-2">Game Prompt</label>
                                <textarea class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 h-32" id="gamePrompt" required></textarea>
                                <p class="text-sm text-gray-400 mt-1">The prompt that will be presented to players</p>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium mb-2">Winning Condition</label>
                                <textarea class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500" id="winningCondition" required></textarea>
                                <p class="text-sm text-gray-400 mt-1">What players need to do to win the game</p>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium mb-2">Game Image</label>
                                <input type="file" class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500" id="gameImage">
                                <p class="text-sm text-gray-400 mt-1">An image for your game (optional)</p>
                            </div>
                        </div>
                        <button type="submit" class="btn-primary px-6 py-3 rounded-lg font-semibold text-white w-full md:w-auto">
                            Create Game
                        </button>
                    </form>
                </div>

                <div class="card p-6">
                    <h2 class="text-2xl font-bold mb-6 game-font text-blue-400">My Games</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="text-left border-b border-gray-700">
                                    <th class="pb-4">Title</th>
                                    <th class="pb-4">Type</th>
                                    <th class="pb-4">Cost</th>
                                    <th class="pb-4">Reward</th>
                                    <th class="pb-4">Token</th>
                                    <th class="pb-4">Players</th>
                                    <th class="pb-4">Status</th>
                                    <th class="pb-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="gamesList" class="divide-y divide-gray-700">
                                <!-- Games will be populated here via JavaScript -->
                            </tbody>
                        </table>
                        <div id="noGamesMessage" class="text-center py-6 text-gray-400">No games created yet. Start by creating a new game!</div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div class="tab-content" id="analytics">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="card p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-blue-500/20">
                                <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold">Total Revenue</h3>
                                <p class="text-2xl font-bold text-blue-400">$0.00</p>
                            </div>
                        </div>
                    </div>
                    <div class="card p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-green-500/20">
                                <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold">Active Games</h3>
                                <p class="text-2xl font-bold text-green-400">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="card p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-purple-500/20">
                                <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold">Total Players</h3>
                                <p class="text-2xl font-bold text-purple-400">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card p-6">
                    <h2 class="text-2xl font-bold mb-6 game-font">Detailed Analytics</h2>
                    <p class="text-gray-400">Detailed analytics and charts coming soon!</p>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="settings">
                <div class="card p-6">
                    <h2 class="text-2xl font-bold mb-6 game-font">Settings</h2>
                    <p class="text-gray-400">Settings dashboard coming soon!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                if (e.target.id === 'logoutBtn') return;

                // Remove active class from all links and tabs
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));

                // Add active class to clicked link and corresponding tab
                e.target.classList.add('active');
                const tabId = e.target.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
            localStorage.removeItem('token');
            window.location.href = '/developers';
        });

        // Token form submission
        document.getElementById('tokenForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const storedToken = localStorage.getItem('token');
            const userData = JSON.parse(storedToken);
            const tokenData = {
                name: document.getElementById('tokenName').value,
                symbol: document.getElementById('tokenSymbol').value,
                decimals: parseInt(document.getElementById('tokenDecimals').value),
                totalSupply: document.getElementById('totalSupply').value,
                uuid: userData.user_id
            };

            try {
                const response = await fetch('/api/create-token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(tokenData)
                });

                const result = await response.json();
                if (response.ok) {
                    alert('Token created successfully!');
                    loadTokens();
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to create token. Please try again.');
            }
        });

        // Game form submission
        document.getElementById('gameForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const storedToken = localStorage.getItem('token');
            if (!storedToken) {
                alert('Please log in to create a game');
                return;
            }
            
            const userData = JSON.parse(storedToken);
            
            // Validate that a token is selected
            const selectedToken = document.getElementById('gameToken').value;
            if (!selectedToken) {
                alert('Please select a token for rewards');
                return;
            }
            
            // Create FormData to handle file upload
            const formData = new FormData();
            
            // Add form fields to FormData
            formData.append('title', document.getElementById('gameTitle').value);
            formData.append('game_type', document.getElementById('gameType').value);
            formData.append('cost_in_core', document.getElementById('costInCore').value);
            formData.append('reward_in_tokens', document.getElementById('tokenReward').value);
            formData.append('token_id', selectedToken);
            formData.append('description', document.getElementById('gameDescription').value);
            formData.append('prompt', document.getElementById('gamePrompt').value);
            formData.append('winning_condition', document.getElementById('winningCondition').value);
            formData.append('uuid', userData.user_id);
            
            // Add image file if provided
            const imageFile = document.getElementById('gameImage').files[0];
            if (imageFile) {
                formData.append('image', imageFile);
            }

            try {
                const submitButton = document.querySelector('#gameForm button[type="submit"]');
                submitButton.disabled = true;
                submitButton.textContent = 'Creating...';
                
                const response = await fetch('/api/create-game', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    alert('Game created successfully!');
                    document.getElementById('gameForm').reset();
                    loadGames();
                } else {
                    alert('Error: ' + result.error);
                }
                
                submitButton.disabled = false;
                submitButton.textContent = 'Create Game';
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to create game. Please try again.');
                document.querySelector('#gameForm button[type="submit"]').disabled = false;
                document.querySelector('#gameForm button[type="submit"]').textContent = 'Create Game';
            }
        });

        // Load tokens
        async function loadTokens() {
            try {
                const storedToken = localStorage.getItem('token');
                const userData = JSON.parse(storedToken);
                
                const response = await fetch('/api/tokens');
                const tokens = await response.json();
                const tokensList = document.getElementById('tokensList');
                
                // Filter tokens for the current developer
                const devTokens = tokens.filter(token => token.creator_uuid === userData.user_id);
                
                tokensList.innerHTML = devTokens.map(token => `
                    <tr class="py-4">
                        <td>${token.name}</td>
                        <td>${token.symbol}</td>
                        <td>${token.total_supply}</td>
                        <td class="font-mono text-sm">${token.contract_address}</td>
                        <td>
                            <button class="btn-primary px-3 py-1 rounded text-sm mr-2">View</button>
                            <button class="px-3 py-1 rounded text-sm bg-red-500/20 text-red-400 hover:bg-red-500/30">Delete</button>
                        </td>
                    </tr>
                `).join('');
                
                // Also populate the token dropdown in the game form
                const gameTokenSelect = document.getElementById('gameToken');
                gameTokenSelect.innerHTML = '<option value="">Select a token</option>' + 
                    devTokens.map(token => `<option value="${token._id}">${token.name} (${token.symbol})</option>`).join('');
                
                // If no tokens are available, show a message and disable the game creation form
                if (devTokens.length === 0) {
                    if (document.getElementById('gameForm')) {
                        const tokenWarning = document.createElement('div');
                        tokenWarning.id = 'tokenWarning';
                        tokenWarning.className = 'text-center py-4 bg-yellow-500/20 text-yellow-400 rounded mb-4';
                        tokenWarning.innerHTML = `
                            <p class="mb-2">You need to create at least one token before creating a game.</p>
                            <button type="button" id="createTokenBtn" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded transition-colors">
                                Create Token First
                            </button>
                        `;
                        
                        const existingWarning = document.getElementById('tokenWarning');
                        if (!existingWarning) {
                            document.getElementById('gameForm').prepend(tokenWarning);
                            
                            // Add click handler to the Create Token button
                            document.getElementById('createTokenBtn').addEventListener('click', () => {
                                // Navigate to the tokens tab
                                document.querySelector('.nav-link[data-tab="tokens"]').click();
                            });
                        }
                        
                        // Disable form inputs
                        document.querySelectorAll('#gameForm input, #gameForm select, #gameForm textarea').forEach(input => {
                            input.disabled = true;
                        });
                        
                        // Disable form submission
                        document.querySelector('#gameForm button[type="submit"]').disabled = true;
                        document.querySelector('#gameForm button[type="submit"]').classList.add('opacity-50', 'cursor-not-allowed');
                    }
                } else {
                    // Enable form submission
                    const existingWarning = document.getElementById('tokenWarning');
                    if (existingWarning) {
                        existingWarning.remove();
                    }
                    
                    // Enable form inputs
                    document.querySelectorAll('#gameForm input, #gameForm select, #gameForm textarea').forEach(input => {
                        input.disabled = false;
                    });
                    
                    if (document.querySelector('#gameForm button[type="submit"]')) {
                        document.querySelector('#gameForm button[type="submit"]').disabled = false;
                        document.querySelector('#gameForm button[type="submit"]').classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                }
            } catch (error) {
                console.error('Error loading tokens:', error);
            }
        }

        // Load games
        async function loadGames() {
            try {
                const storedToken = localStorage.getItem('token');
                const userData = JSON.parse(storedToken);
                
                const response = await fetch(`/api/games?developer_id=${userData.user_id}`);
                const games = await response.json();
                
                const gamesList = document.getElementById('gamesList');
                const noGamesMessage = document.getElementById('noGamesMessage');
                
                if (games.length > 0) {
                    noGamesMessage.style.display = 'none';
                    gamesList.innerHTML = games.map(game => `
                        <tr class="py-4">
                            <td>${game.title}</td>
                            <td>${getGameTypeName(game.game_type)}</td>
                            <td>${game.cost_in_core} CORE</td>
                            <td>${game.reward_in_tokens}</td>
                            <td>${game.token_name} (${game.token_symbol})</td>
                            <td>${game.players || 0}</td>
                            <td>
                                <span class="px-2 py-1 rounded-full text-xs ${
                                    game.status === 'active' ? 'bg-green-500/20 text-green-400' : 
                                    game.status === 'paused' ? 'bg-yellow-500/20 text-yellow-400' : 
                                    game.status === 'released' ? 'bg-purple-500/20 text-purple-400' :
                                    'bg-red-500/20 text-red-400'
                                }">${game.status || 'inactive'}</span>
                            </td>
                            <td>
                                <button class="btn-primary px-3 py-1 rounded text-sm mr-2" data-game-id="${game._id}">Edit</button>
                                ${game.status !== 'released' ? `
                                <button class="px-3 py-1 rounded text-sm ${
                                    game.status === 'active' ? 'bg-yellow-500/20 text-yellow-400 hover:bg-yellow-500/30' : 
                                    'bg-green-500/20 text-green-400 hover:bg-green-500/30'
                                }" data-game-id="${game._id}" data-action="${game.status === 'active' ? 'pause' : 'activate'}">
                                    ${game.status === 'active' ? 'Pause' : 'Activate'}
                                </button>
                                ${game.status === 'active' ? `
                                <button class="px-3 py-1 rounded text-sm bg-purple-500/20 text-purple-400 hover:bg-purple-500/30" data-game-id="${game._id}" data-action="release">
                                    Release
                                </button>
                                ` : ''}
                                ` : ''}
                                <button class="px-3 py-1 rounded text-sm bg-blue-500/20 text-blue-400 hover:bg-blue-500/30" data-game-id="${game._id}" data-action="test-gameplay">
                                    Test Gameplay
                                </button>
                                <button class="px-3 py-1 rounded text-sm bg-red-500/20 text-red-400 hover:bg-red-500/30" data-game-id="${game._id}" data-action="delete">Delete</button>
                            </td>
                        </tr>
                    `).join('');
                    
                    // Add event listeners to the action buttons
                    document.querySelectorAll('[data-game-id]').forEach(button => {
                        button.addEventListener('click', handleGameAction);
                    });
                } else {
                    noGamesMessage.style.display = 'block';
                    gamesList.innerHTML = '';
                }
            } catch (error) {
                console.error('Error loading games:', error);
            }
        }

        // Helper function to get game type name from ID
        function getGameTypeName(typeId) {
            const gameTypes = {
                1: 'Text Adventure',
                2: 'Strategy Game',
                3: 'Puzzle Game',
                4: 'RPG',
                5: 'Other'
            };
            return gameTypes[typeId] || 'Unknown';
        }
        
        // Handle game actions (edit, activate/pause, delete)
        async function handleGameAction(e) {
            const gameId = e.target.getAttribute('data-game-id');
            const action = e.target.getAttribute('data-action');
            
            if (!gameId) return;
            
            if (action === 'delete') {
                if (!confirm('Are you sure you want to delete this game?')) return;
                
                try {
                    const response = await fetch(`/api/games/${gameId}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        alert('Game deleted successfully!');
                        loadGames();
                    } else {
                        const result = await response.json();
                        alert('Error: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Failed to delete game. Please try again.');
                }
            } else if (action === 'activate' || action === 'pause') {
                try {
                    const response = await fetch(`/api/games/${gameId}/status`, {
                        method: 'PATCH',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            status: action === 'activate' ? 'active' : 'paused'
                        })
                    });
                    
                    if (response.ok) {
                        alert(`Game ${action === 'activate' ? 'activated' : 'paused'} successfully!`);
                        loadGames();
                    } else {
                        const result = await response.json();
                        alert('Error: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert(`Failed to ${action} game. Please try again.`);
                }
            } else if (action === 'release') {
                if (!confirm('Are you sure you want to release this game to production?')) return;
                
                try {
                    const response = await fetch(`/api/games/${gameId}/release`, {
                        method: 'PATCH',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        alert('Game released to production successfully!');
                        loadGames();
                    } else {
                        const result = await response.json();
                        alert('Error: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Failed to release game. Please try again.');
                }
            } else if (action === 'test-gameplay') {
                startGameTest(gameId);
            } else {
                // Handle edit action - could open a modal or redirect to an edit page
                alert('Edit functionality coming soon!');
            }
        }

        // Load tokens when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadTokens();
            loadGames();
            loadBouncerRules();
        });

        // Load bouncer rules
        async function loadBouncerRules() {
            try {
                const storedToken = localStorage.getItem('token');
                const userData = JSON.parse(storedToken);
                
                const response = await fetch(`/api/tokenguard/rules/${userData.user_id}`);
                const rules = await response.json();
                
                if (response.ok) {
                    // Fill in the form fields with existing rules
                    document.querySelector('textarea[name="gameDescription"]').value = rules.game_description.content || '';
                    document.querySelector('textarea[name="customerProfile"]').value = rules.customer_profile.content || '';
                    document.querySelector('textarea[name="tokenEconomy"]').value = rules.token_economy.content || '';
                    
                    // If there are existing rules, show last updated time
                    if (rules.game_description.last_updated) {
                        const lastUpdated = new Date(rules.game_description.last_updated).toLocaleString();
                    }
                } else {
                    console.error('Error loading bouncer rules:', rules.error);
                }
            } catch (error) {
                console.error('Error loading bouncer rules:', error);
            }
        }

        // Add this to your existing script section
        document.getElementById('tokenGuardForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const storedToken = localStorage.getItem('token');
            const userData = JSON.parse(storedToken);
            
            const formData = new FormData(e.target);
            const tokenGuardData = {
                gameDescription: formData.get('gameDescription'),
                customerProfile: formData.get('customerProfile'),
                tokenEconomy: formData.get('tokenEconomy'),
                uuid: userData.user_id
            };

            try {
                const response = await fetch('/api/tokenguard/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(tokenGuardData)
                });

                const result = await response.json();
                if (response.ok) {
                    console.log('TokenGuard settings saved successfully!');
                    window.reload();
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to save TokenGuard settings. Please try again.');
            }
        });

        // Modal functionality
        const modal = document.getElementById('bouncerModal');
        const tryBouncerBtn = document.getElementById('tryBouncerBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const chatForm = document.getElementById('chatForm');
        const chatInput = document.getElementById('chatInput');
        const chatMessages = document.getElementById('chatMessages');

        // Add these variables at the top of your script section
        let currentSessionId = null;
        let isBouncerActive = false;

        // Update the tryBouncerBtn click handler
        document.getElementById('tryBouncerBtn').addEventListener('click', async () => {
            const storedToken = localStorage.getItem('token');
            if (!storedToken) {
                alert('Please log in first');
                return;
            }

            const userData = JSON.parse(storedToken);
            
            try {
                const response = await fetch('/start_bouncer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        uuid: userData.user_id
                    })
                });

                const result = await response.json();
                if (response.ok) {
                    currentSessionId = result.session_id;
                    isBouncerActive = true;
                    
                    // Show the modal
                    modal.classList.remove('hidden');
                    modal.classList.add('flex');
                    
                    // Add the initial system message
                    addMessage('system', result.initial_response);
                } else {
                    alert('Error starting bouncer: ' + result.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to start bouncer test. Please try again.');
            }
        });

        // Update the chat form submission handler
        document.getElementById('chatForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentSessionId) {
                alert('No active bouncer session. Please start a new test.');
                return;
            }

            const message = chatInput.value.trim();
            if (!message) return;

            // Add user message to chat
            addMessage('user', message);
            chatInput.value = '';

            try {
                const response = await fetch(`/chat/${currentSessionId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message })
                });

                const result = await response.json();
                if (response.ok) {
                    addMessage('system', result.response);
                } else {
                    addMessage('system', 'Error: ' + result.error);
                }
            } catch (error) {
                console.error('Error:', error);
                addMessage('system', 'Failed to get response. Please try again.');
            }
        });

        // Add end bouncer test functionality
        document.getElementById('endBouncerBtn').addEventListener('click', async () => {
            if (!currentSessionId) {
                alert('No active bouncer session to end.');
                return;
            }

            try {
                const response = await fetch(`/end_bouncer_test/${currentSessionId}`, {
                    method: 'POST'
                });

                const result = await response.json();
                if (response.ok) {
                    addMessage('system', 'Bouncer test session ended.');
                    setTimeout(() => {
                        modal.classList.add('hidden');
                        modal.classList.remove('flex');
                        chatMessages.innerHTML = '';
                        currentSessionId = null;
                        isBouncerActive = false;
                    }, 2000);
                } else {
                    alert('Error ending session: ' + result.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to end bouncer test. Please try again.');
            }
        });

        // Update the close modal button to properly end the session
        document.getElementById('closeModalBtn').addEventListener('click', async () => {
            if (currentSessionId) {
                if (confirm('Do you want to end the current bouncer session?')) {
                    try {
                        await fetch(`/end_bouncer_test/${currentSessionId}`, {
                            method: 'POST'
                        });
                        currentSessionId = null;
                        isBouncerActive = false;
                    } catch (error) {
                        console.error('Error ending session:', error);
                    }
                } else {
                    return; // Don't close the modal if user cancels
                }
            }
            
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            chatMessages.innerHTML = '';
        });

        // Update the modal click handler to check for active session
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                if (currentSessionId) {
                    if (confirm('Do you want to end the current bouncer session?')) {
                        fetch(`/end_bouncer_test/${currentSessionId}`, {
                            method: 'POST'
                        }).then(() => {
                            currentSessionId = null;
                            isBouncerActive = false;
                            modal.classList.add('hidden');
                            modal.classList.remove('flex');
                            chatMessages.innerHTML = '';
                        }).catch(error => {
                            console.error('Error ending session:', error);
                        });
                    }
                } else {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                    chatMessages.innerHTML = '';
                }
            }
        });

        // Update the addMessage function to include timestamps and better styling
        function addMessage(type, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${type === 'user' ? 'justify-end' : 'justify-start'} items-start space-x-2`;
            
            const timestamp = new Date().toLocaleTimeString();
            
            const messageContent = document.createElement('div');
            messageContent.className = `max-w-[80%] rounded-lg p-4 ${
                type === 'user' 
                    ? 'bg-blue-500 text-white' 
                    : 'bg-gray-700 text-gray-200'
            }`;
            
            const messageText = document.createElement('div');
            messageText.className = 'text-sm';
            messageText.textContent = content;
            
            const timeText = document.createElement('div');
            timeText.className = 'text-xs text-gray-400 mt-1';
            timeText.textContent = timestamp;
            
            messageContent.appendChild(messageText);
            messageContent.appendChild(timeText);
            
            messageDiv.appendChild(messageContent);
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Game Test Modal Functionality
        const gameplayModal = document.getElementById('gameplayModal');
        const closeGameplayModalBtn = document.getElementById('closeGameplayModalBtn');
        const gameTestForm = document.getElementById('gameTestForm');
        const gameInput = document.getElementById('gameInput');
        const gameMessages = document.getElementById('gameMessages');
        const gameTestTitle = document.getElementById('gameTestTitle');
        const endGameTestBtn = document.getElementById('endGameTestBtn');

        let currentGameId = null;
        let currentGameSessionId = null;
        let isGameActive = false;

        // Function to start a game test
        async function startGameTest(gameId) {
            const storedToken = localStorage.getItem('token');
            if (!storedToken) {
                alert('Please log in first');
                return;
            }

            const userData = JSON.parse(storedToken);
            
            try {
                // First, get the game details to show the title
                const gameResponse = await fetch(`/api/games/${gameId}`);
                const game = await gameResponse.json();
                if (!gameResponse.ok) {
                    throw new Error(game.error || 'Failed to fetch game details');
                }
                
                gameTestTitle.textContent = ` - ${game.title}`;
                
                // Start the game test session
                const response = await fetch('/start_game_test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        game_id: gameId,
                        user_uuid: userData.user_id
                    })
                });

                const result = await response.json();
                if (response.ok) {
                    currentGameId = gameId;
                    currentGameSessionId = result.session_id;
                    isGameActive = true;
                    
                    // Show the modal
                    gameplayModal.classList.remove('hidden');
                    gameplayModal.classList.add('flex');
                    
                    // Add the initial system message
                    addGameMessage('system', result.initial_response);
                } else {
                    alert('Error starting game test: ' + result.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to start game test. Please try again.');
            }
        }

        // Game form submission handler
        gameTestForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentGameSessionId) {
                alert('No active game session. Please start a new test.');
                return;
            }

            const message = gameInput.value.trim();
            if (!message) return;

            // Add user message to chat
            addGameMessage('user', message);
            gameInput.value = '';

            try {
                const response = await fetch(`/chat_game/${currentGameSessionId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message })
                });

                const result = await response.json();
                if (response.ok) {
                    addGameMessage('system', result.response);
                } else {
                    addGameMessage('system', 'Error: ' + result.error);
                }
            } catch (error) {
                console.error('Error:', error);
                addGameMessage('system', 'Failed to get response. Please try again.');
            }
        });

        // End game test functionality
        endGameTestBtn.addEventListener('click', async () => {
            if (!currentGameSessionId) {
                alert('No active game session to end.');
                return;
            }

            try {
                const response = await fetch(`/end_game_test/${currentGameSessionId}`, {
                    method: 'POST'
                });

                const result = await response.json();
                if (response.ok) {
                    addGameMessage('system', 'Game test session ended.');
                    setTimeout(() => {
                        gameplayModal.classList.add('hidden');
                        gameplayModal.classList.remove('flex');
                        gameMessages.innerHTML = '';
                        currentGameSessionId = null;
                        currentGameId = null;
                        isGameActive = false;
                    }, 2000);
                } else {
                    alert('Error ending session: ' + result.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to end game test. Please try again.');
            }
        });

        // Close game modal button handler
        closeGameplayModalBtn.addEventListener('click', async () => {
            if (currentGameSessionId) {
                if (confirm('Do you want to end the current game session?')) {
                    try {
                        await fetch(`/end_game_test/${currentGameSessionId}`, {
                            method: 'POST'
                        });
                        currentGameSessionId = null;
                        currentGameId = null;
                        isGameActive = false;
                    } catch (error) {
                        console.error('Error ending game session:', error);
                    }
                } else {
                    return; // Don't close the modal if user cancels
                }
            }
            
            gameplayModal.classList.add('hidden');
            gameplayModal.classList.remove('flex');
            gameMessages.innerHTML = '';
        });

        // Game modal click handler
        gameplayModal.addEventListener('click', (e) => {
            if (e.target === gameplayModal) {
                if (currentGameSessionId) {
                    if (confirm('Do you want to end the current game session?')) {
                        fetch(`/end_game_test/${currentGameSessionId}`, {
                            method: 'POST'
                        }).then(() => {
                            currentGameSessionId = null;
                            currentGameId = null;
                            isGameActive = false;
                            gameplayModal.classList.add('hidden');
                            gameplayModal.classList.remove('flex');
                            gameMessages.innerHTML = '';
                        }).catch(error => {
                            console.error('Error ending game session:', error);
                        });
                    }
                } else {
                    gameplayModal.classList.add('hidden');
                    gameplayModal.classList.remove('flex');
                    gameMessages.innerHTML = '';
                }
            }
        });

        // Function to add a message to the game chat
        function addGameMessage(type, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${type === 'user' ? 'justify-end' : 'justify-start'} items-start space-x-2`;
            
            const timestamp = new Date().toLocaleTimeString();
            
            const messageContent = document.createElement('div');
            messageContent.className = `max-w-[80%] rounded-lg p-4 ${
                type === 'user' 
                    ? 'bg-blue-500 text-white' 
                    : 'bg-purple-700 text-gray-200'
            }`;
            
            const messageText = document.createElement('div');
            messageText.className = 'text-sm';
            messageText.textContent = content;
            
            const timeText = document.createElement('div');
            timeText.className = 'text-xs text-gray-400 mt-1';
            timeText.textContent = timestamp;
            
            messageContent.appendChild(messageText);
            messageContent.appendChild(timeText);
            
            messageDiv.appendChild(messageContent);
            
            gameMessages.appendChild(messageDiv);
            gameMessages.scrollTop = gameMessages.scrollHeight;
        }
    </script>
</body>
</html> 